<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ó–∞–≤—É—á-–ü—Ä–æ: –£—á—ë—Ç –∑–∞–º–µ–Ω</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <style>
        @media print {
            .no-print { display: none !important; }
            body { background: white !important; }
            table { border-collapse: collapse; width: 100%; font-size: 12px; }
            th, td { border: 1px solid #000 !important; padding: 6px !important; }
            .badge-50 { color: #000 !important; background: none !important; border: 1px solid #000; }
        }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-slate-50 min-h-screen font-sans text-slate-900">

<div class="max-w-6xl mx-auto px-4 py-6">
    <!-- Header -->
    <header class="flex justify-between items-center mb-8 no-print">
        <div>
            <h1 class="text-3xl font-bold text-indigo-700">üçé –ó–∞–≤—É—á-–ü—Ä–æ</h1>
            <p class="text-slate-500 text-sm">–°–∏—Å—Ç–µ–º–∞ —Ñ–∏–∫—Å–∞—Ü–∏–∏ —à–∫–æ–ª—å–Ω—ã—Ö –∑–∞–º–µ–Ω</p>
        </div>
        <div class="text-right">
            <span class="bg-indigo-100 text-indigo-700 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider">v1.2 Active</span>
        </div>
    </header>

    <!-- Stats -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8 no-print">
        <div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-100 text-center">
            <div id="statTotal" class="text-2xl font-bold text-indigo-600">0</div>
            <div class="text-xs text-slate-500 uppercase font-semibold">–í—Å–µ–≥–æ –∑–∞–º–µ–Ω</div>
        </div>
        <div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-100 text-center">
            <div id="stat100" class="text-2xl font-bold text-emerald-600">0</div>
            <div class="text-xs text-slate-500 uppercase font-semibold text-nowrap">–û–∫–Ω–æ (100%)</div>
        </div>
        <div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-100 text-center">
            <div id="stat50" class="text-2xl font-bold text-amber-500">0</div>
            <div class="text-xs text-slate-500 uppercase font-semibold text-nowrap">–°–≤–æ–π —É—Ä–æ–∫ (50%)</div>
        </div>
        <div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-100 text-center">
            <div id="statMonth" class="text-2xl font-bold text-slate-700">0</div>
            <div class="text-xs text-slate-500 uppercase font-semibold">–í —ç—Ç–æ–º –º–µ—Å—è—Ü–µ</div>
        </div>
    </div>

    <!-- Form -->
    <div class="bg-white rounded-3xl shadow-xl p-6 mb-8 no-print border border-slate-100">
        <h2 class="text-lg font-bold mb-4 flex items-center gap-2 text-slate-700">
            <span class="bg-indigo-600 text-white p-1 rounded-lg">‚ûï</span> –ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å
        </h2>
        <form id="repForm" class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="md:col-span-1">
                <label class="block text-xs font-bold text-slate-500 mb-1 uppercase">–î–∞—Ç–∞</label>
                <input type="date" id="date" required class="w-full bg-slate-50 border-none rounded-xl px-4 py-3 focus:ring-2 focus:ring-indigo-500 transition">
            </div>
            <div class="md:col-span-1">
                <label class="block text-xs font-bold text-slate-500 mb-1 uppercase">–¢–∏–ø –æ–ø–ª–∞—Ç—ã</label>
                <select id="type" class="w-full bg-slate-50 border-none rounded-xl px-4 py-3 focus:ring-2 focus:ring-indigo-500 transition">
                    <option value="100">100% (–û–∫–Ω–æ)</option>
                    <option value="50">50% (–°–≤–æ–π —É—Ä–æ–∫)</option>
                </select>
            </div>
            <div class="md:col-span-1">
                <label class="block text-xs font-bold text-slate-500 mb-1 uppercase">–ü—Ä–µ–¥–º–µ—Ç</label>
                <input list="subjects" id="subject" placeholder="–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞" required class="w-full bg-slate-50 border-none rounded-xl px-4 py-3 focus:ring-2 focus:ring-indigo-500 transition">
            </div>
            <div class="md:col-span-1">
                <label class="block text-xs font-bold text-slate-500 mb-1 uppercase">–ó–∞–º–µ–Ω—è–µ–º—ã–π</label>
                <input list="teachers" id="who" placeholder="–§–ò–û –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–µ–≥–æ" required class="w-full bg-slate-50 border-none rounded-xl px-4 py-3 focus:ring-2 focus:ring-indigo-500 transition">
            </div>
            <div class="md:col-span-2">
                <label class="block text-xs font-bold text-slate-500 mb-1 uppercase">–ó–∞–º–µ–Ω—è—é—â–∏–π</label>
                <input list="teachers" id="by" placeholder="–§–ò–û –∫—Ç–æ –≤–µ–¥–µ—Ç —É—Ä–æ–∫" required class="w-full bg-slate-50 border-none rounded-xl px-4 py-3 focus:ring-2 focus:ring-indigo-500 transition">
            </div>
            <button type="submit" class="md:col-span-3 bg-indigo-600 text-white font-bold py-4 rounded-xl hover:bg-indigo-700 shadow-lg shadow-indigo-200 transition active:scale-[0.98]">
                –î–û–ë–ê–í–ò–¢–¨ –í –ñ–£–†–ù–ê–õ
            </button>
        </form>
    </div>

    <!-- Table -->
    <div id="printArea" class="bg-white rounded-3xl shadow-xl overflow-hidden border border-slate-100 p-2 md:p-6">
        <div class="flex flex-col md:flex-row justify-between items-center mb-6 px-4 no-print gap-4">
            <h2 class="text-xl font-bold text-slate-800">–ñ—É—Ä–Ω–∞–ª –∑–∞–º–µ–Ω</h2>
            <div class="flex gap-2">
                <button onclick="window.print()" class="bg-emerald-500 text-white px-5 py-2 rounded-xl text-sm font-bold hover:bg-emerald-600 transition">üñ®Ô∏è –ü–ï–ß–ê–¢–¨</button>
                <button onclick="exportJSON()" class="bg-slate-700 text-white px-5 py-2 rounded-xl text-sm font-bold hover:bg-slate-800 transition">üì• EXPORT</button>
            </div>
        </div>

        <div class="overflow-x-auto">
            <table class="w-full">
                <thead>
                    <tr class="bg-slate-50 text-slate-500 text-xs uppercase tracking-widest font-bold">
                        <th class="px-6 py-4 text-left">–î–∞—Ç–∞</th>
                        <th class="px-6 py-4 text-left">–ü—Ä–µ–¥–º–µ—Ç</th>
                        <th class="px-6 py-4 text-left">–ó–∞–º–µ–Ω—è–µ–º—ã–π</th>
                        <th class="px-6 py-4 text-left">–ó–∞–º–µ–Ω—è—é—â–∏–π</th>
                        <th class="px-6 py-4 text-center">–¢–∏–ø</th>
                        <th class="px-6 py-4 text-right no-print">–î–µ–π—Å—Ç–≤–∏–µ</th>
                    </tr>
                </thead>
                <tbody id="tableBody" class="divide-y divide-slate-100"></tbody>
            </table>
        </div>

        <!-- Print Footer -->
        <div class="hidden print:block mt-12 px-6">
            <div class="grid grid-cols-2 gap-20">
                <div class="border-t border-slate-400 pt-2 text-sm text-center font-medium">–ó–∞–º–µ—Å—Ç–∏—Ç–µ–ª—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞ (–ø–æ–¥–ø–∏—Å—å / –§–ò–û)</div>
                <div class="border-t border-slate-400 pt-2 text-sm text-center font-medium">–ë—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è (–ø—Ä–∏–Ω—è–ª)</div>
            </div>
        </div>
    </div>
</div>

<datalist id="teachers"></datalist>
<datalist id="subjects"></datalist>

<script>
    let replacements = JSON.parse(localStorage.getItem('subpro_v12')) || [];
    let teachers = JSON.parse(localStorage.getItem('teachers_v12')) || [];
    let subjects = JSON.parse(localStorage.getItem('subjects_v12')) || [];

    document.getElementById('date').valueAsDate = new Date();

    document.getElementById('repForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const rec = {
            id: Date.now(),
            date: document.getElementById('date').value,
            type: document.getElementById('type').value,
            subject: document.getElementById('subject').value.trim(),
            who: document.getElementById('who').value.trim(),
            by: document.getElementById('by').value.trim()
        };

        replacements.push(rec);
        updateMasterData(rec);
        save();
        render();
        this.reset();
        document.getElementById('date').valueAsDate = new Date();
    });

    function updateMasterData(rec) {
        if(!teachers.includes(rec.who)) teachers.push(rec.who);
        if(!teachers.includes(rec.by)) teachers.push(rec.by);
        if(!subjects.includes(rec.subject)) subjects.push(rec.subject);
    }

    function save() {
        localStorage.setItem('subpro_v12', JSON.stringify(replacements));
        localStorage.setItem('teachers_v12', JSON.stringify(teachers));
        localStorage.setItem('subjects_v12', JSON.stringify(subjects));
    }

    function render() {
        const tbody = document.getElementById('tableBody');
        const sorted = [...replacements].sort((a,b) => new Date(b.date) - new Date(a.date));
        
        tbody.innerHTML = sorted.map(r => `
            <tr class="hover:bg-indigo-50 transition fade-in text-sm">
                <td class="px-6 py-4 font-medium">${new Date(r.date).toLocaleDateString('ru-RU')}</td>
                <td class="px-6 py-4 text-indigo-600 font-semibold">${r.subject}</td>
                <td class="px-6 py-4 text-slate-500">${r.who}</td>
                <td class="px-6 py-4 font-bold text-slate-700">${r.by}</td>
                <td class="px-6 py-4 text-center">
                    <span class="px-3 py-1 rounded-lg text-[10px] font-bold ${r.type == '100' ? 'bg-emerald-100 text-emerald-700' : 'bg-amber-100 text-amber-700'}">
                        ${r.type}%
                    </span>
                </td>
                <td class="px-6 py-4 text-right no-print">
                    <button onclick="del(${r.id})" class="text-rose-400 hover:text-rose-600 transition p-2">‚úï</button>
                </td>
            </tr>
        `).join('') || '<tr><td colspan="6" class="text-center py-12 text-slate-400">–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π. –°–∞–º–æ–µ –≤—Ä–µ–º—è –¥–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—É—é!</td></tr>';

        updateStats();
        updateDatalists();
    }

    function updateStats() {
        const now = new Date();
        document.getElementById('statTotal').textContent = replacements.length;
        document.getElementById('stat100').textContent = replacements.filter(r => r.type == '100').length;
        document.getElementById('stat50').textContent = replacements.filter(r => r.type == '50').length;
        document.getElementById('statMonth').textContent = replacements.filter(r => new Date(r.date).getMonth() === now.getMonth()).length;
    }

    function updateDatalists() {
        document.getElementById('teachers').innerHTML = teachers.map(t => `<option value="${t}">`).join('');
        document.getElementById('subjects').innerHTML = subjects.map(s => `<option value="${s}">`).join('');
    }

    function del(id) {
        if(confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–ø–∏—Å—å?')) {
            replacements = replacements.filter(r => r.id !== id);
            save();
            render();
        }
    }

    function exportJSON() {
        const data = { replacements, teachers, subjects };
        const blob = new Blob([JSON.stringify(data)], {type: 'application/json'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `zameny_pro_${new Date().toISOString().slice(0,10)}.json`;
        a.click();
    }

    render();
</script>
</body>
</html>
