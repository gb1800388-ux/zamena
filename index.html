<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>–ó–∞–≤—É—á.PRO v6.1</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <style>
        * { -webkit-tap-highlight-color: transparent; -webkit-touch-callout: none; }
        body { 
            overscroll-behavior-y: contain;
            background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
            min-height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }
        .safe-top { padding-top: env(safe-area-inset-top); }
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
        .glass { background: rgba(255,255,255,0.95); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); }
        .glass-dark { background: rgba(255,255,255,0.15); backdrop-filter: blur(10px); }

        /* –°–∫—Ä–æ–ª–ª–∏–Ω–≥ —Å–ø–∏—Å–∫–æ–≤ –§–ò–û –∏ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ */
        .quick-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
            max-height: 180px; 
            overflow-y: auto;
            padding: 10px;
            -webkit-overflow-scrolling: touch;
            background: rgba(248, 250, 252, 0.5);
            border-radius: 1.25rem;
        }

        /* Swipe Logic */
        .swipe-container { position: relative; overflow: hidden; border-radius: 1.5rem; margin-bottom: 0.75rem; background: #ef4444; }
        .swipe-item { 
            position: relative; z-index: 10; background: white; 
            transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
            touch-action: pan-y;
        }
        .swipe-action { position: absolute; right: 0; top: 0; bottom: 0; width: 80px; display: flex; align-items: center; justify-content: center; color: white; font-weight: 900; font-size: 0.6rem; }

        /* Wizard & Modals */
        .modal-sheet {
            position: fixed; bottom: 0; left: 0; right: 0; background: white;
            border-radius: 2.5rem 2.5rem 0 0; z-index: 101;
            transform: translateY(100%); transition: transform 0.4s cubic-bezier(0.25, 1, 0.5, 1);
            max-height: 92vh; overflow-y: auto;
        }
        .modal-sheet.active { transform: translateY(0); }
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.4); backdrop-filter: blur(6px); z-index: 100; visibility: hidden; opacity: 0; transition: 0.3s; }
        .modal-overlay.active { visibility: visible; opacity: 1; }

        .big-input { font-size: 1.5rem; font-weight: 800; text-align: center; background: #f8fafc; border: 3px solid #e2e8f0; border-radius: 1.5rem; padding: 1.25rem; width: 100%; outline: none; transition: 0.3s; }
        .big-input:focus { border-color: #6366f1; background: white; }
        
        .lesson-btn { width: 48px; height: 48px; border-radius: 1rem; display: flex; align-items: center; justify-content: center; font-weight: 900; background: #f1f5f9; cursor: pointer; transition: 0.2s; }
        .lesson-btn.active { background: #6366f1; color: white; transform: scale(1.1); box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4); }

        .toast { position: fixed; bottom: 6rem; left: 50%; transform: translateX(-50%) translateY(100px); background: #1e293b; color: white; padding: 1rem 2rem; border-radius: 1.25rem; transition: 0.3s; z-index: 1000; font-weight: 600; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        .toast.show { transform: translateX(-50%) translateY(0); }
        
        .fab { position: fixed; bottom: 2.5rem; right: 1.5rem; width: 68px; height: 68px; background: #f59e0b; color: white; border-radius: 50%; font-size: 36px; display: flex; align-items: center; justify-content: center; box-shadow: 0 12px 30px rgba(245, 158, 11, 0.5); z-index: 50; border: none; cursor: pointer; }
    </style>
</head>
<body class="safe-top">

    <div class="max-w-xl mx-auto px-4 py-4 pb-32">
        <header class="flex justify-between items-center mb-6 no-print">
            <h1 class="text-2xl font-black text-white italic tracking-tighter drop-shadow-md">–ó–ê–í–£–ß<span class="text-yellow-300">.PRO</span></h1>
            <div class="flex gap-3 text-white/90 text-xs font-bold uppercase tracking-widest">
                <button onclick="exportJSON()">Backup üì•</button>
                <button onclick="window.print()">–ü–µ—á–∞—Ç—å üñ®Ô∏è</button>
            </div>
        </header>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="grid grid-cols-4 gap-2 mb-6 no-print">
            <div class="glass p-3 rounded-2xl text-center shadow-sm">
                <div id="statTotal" class="text-lg font-black text-slate-800">0</div>
                <div class="text-[8px] font-bold text-slate-400 uppercase leading-none">–í—Å–µ–≥–æ</div>
            </div>
            <div class="glass p-3 rounded-2xl border-b-4 border-blue-500 text-center shadow-sm">
                <div id="stat100" class="text-lg font-black text-blue-600">0</div>
                <div class="text-[8px] font-bold text-slate-400 uppercase leading-none">–û–∫–Ω–æ</div>
            </div>
            <div class="glass p-3 rounded-2xl border-b-4 border-amber-500 text-center shadow-sm">
                <div id="stat50" class="text-lg font-black text-amber-600">0</div>
                <div class="text-[8px] font-bold text-slate-400 uppercase leading-none">–£—Ä–æ–∫</div>
            </div>
            <div class="glass p-3 rounded-2xl text-center shadow-sm">
                <div id="statMonth" class="text-lg font-black text-slate-700">0</div>
                <div class="text-[8px] font-bold text-slate-400 uppercase leading-none">–ú–µ—Å—è—Ü</div>
            </div>
        </div>

        <!-- –§–∏–ª—å—Ç—Ä -->
        <div class="mb-4 no-print">
            <input type="text" id="search" placeholder="–ü–æ–∏—Å–∫ —É—á–∏—Ç–µ–ª—è –∏–ª–∏ –ø—Ä–µ–¥–º–µ—Ç–∞..." oninput="render()" class="w-full glass border-none rounded-2xl px-6 py-4 text-sm focus:ring-2 focus:ring-white outline-none shadow-sm">
        </div>

        <div id="journal" class="space-y-1"></div>
    </div>

    <button onclick="openWizard()" class="fab no-print">+</button>

    <!-- Wizard Modal -->
    <div id="overlay" class="modal-overlay" onclick="closeWizard()"></div>
    <div id="wizard" class="modal-sheet p-8 safe-bottom">
        <div class="w-12 h-1.5 bg-slate-200 rounded-full mx-auto mb-8"></div>
        
        <!-- –®–∞–≥ 1: –î–∞—Ç–∞ –∏ –£—Ä–æ–∫ -->
        <div id="step1" class="step active space-y-6">
            <div class="text-center">
                <div class="text-4xl mb-2">üìÖ</div>
                <h3 class="text-xl font-black text-slate-800 uppercase italic tracking-tight">–ö–æ–≥–¥–∞ –∑–∞–º–µ–Ω–∞?</h3>
            </div>
            <input type="date" id="wDate" class="big-input text-blue-600">
            <div class="flex justify-between gap-1" id="lessonGrid"></div>
            <button onclick="next(2)" class="w-full bg-indigo-600 text-white font-black py-5 rounded-2xl shadow-xl active:scale-[0.98] transition">–î–ê–õ–ï–ï ‚Üí</button>
        </div>

        <!-- –®–∞–≥ 2: –ö–ª–∞—Å—Å –∏ –ü—Ä–µ–¥–º–µ—Ç -->
        <div id="step2" class="step hidden space-y-6">
            <div class="text-center">
                <div class="text-4xl mb-2">üè´</div>
                <h3 class="text-xl font-black text-slate-800 uppercase italic tracking-tight">–ì–¥–µ –∏ —á—Ç–æ?</h3>
            </div>
            <input type="text" id="wClass" placeholder="–ö–õ–ê–°–° (–ù–ê–ü–†. 5–ê)" class="big-input uppercase">
            <input type="text" id="wSubject" placeholder="–ü–†–ï–î–ú–ï–¢" class="big-input">
            <div class="flex gap-3">
                <button onclick="next(1)" class="w-1/3 bg-slate-100 py-5 rounded-2xl font-bold text-slate-400">‚Üê</button>
                <button onclick="next(3)" class="w-2/3 bg-indigo-600 text-white font-black py-5 rounded-2xl shadow-xl">–î–ê–õ–ï–ï ‚Üí</button>
            </div>
        </div>

        <!-- –®–∞–≥ 3: –£—á–∏—Ç–µ–ª—è -->
        <div id="step3" class="step hidden space-y-6">
            <div class="text-center">
                <div class="text-4xl mb-2">üë®‚Äçüè´</div>
                <h3 class="text-xl font-black text-slate-800 uppercase italic tracking-tight">–ö—Ç–æ –∫–æ–≥–æ?</h3>
            </div>
            <div class="space-y-3">
                <input type="text" id="wWho" placeholder="–ö–¢–û –û–¢–°–£–¢–°–¢–í–£–ï–¢" class="big-input text-base">
                <input type="text" id="wBy" placeholder="–ö–¢–û –ó–ê–ú–ï–ù–Ø–ï–¢" class="big-input text-base">
            </div>
            <div class="flex gap-3">
                <button onclick="next(2)" class="w-1/3 bg-slate-100 py-5 rounded-2xl font-bold text-slate-400">‚Üê</button>
                <button onclick="next(4)" class="w-2/3 bg-indigo-600 text-white font-black py-5 rounded-2xl shadow-xl">–î–ê–õ–ï–ï ‚Üí</button>
            </div>
        </div>

        <!-- –®–∞–≥ 4 (–§–∏–Ω–∞–ª): –û–ø–ª–∞—Ç–∞ –∏ –ò—Ç–æ–≥ -->
        <div id="step4" class="step hidden space-y-6">
            <div class="text-center">
                <div class="text-4xl mb-2">üí∞</div>
                <h3 class="text-xl font-black text-slate-800 uppercase italic tracking-tight">–¢–∏–ø –æ–ø–ª–∞—Ç—ã</h3>
            </div>
            
            <!-- –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –≤ —Å—Ç–∏–ª–µ iOS -->
            <div class="flex bg-slate-100 p-1.5 rounded-2xl border border-slate-200">
                <button type="button" onclick="selectType('100')" id="btn100" class="flex-1 py-4 rounded-xl font-black text-sm transition-all bg-white shadow-sm text-blue-600">
                    üî• 100% (–û–ö–ù–û)
                </button>
                <button type="button" onclick="selectType('50')" id="btn50" class="flex-1 py-4 rounded-xl font-black text-sm transition-all text-slate-400">
                    ‚è≥ 50% (–£–†–û–ö)
                </button>
            </div>
            
            <div class="bg-indigo-50 rounded-3xl p-6 border border-indigo-100">
                <div class="text-[10px] font-bold text-indigo-400 uppercase mb-3 tracking-widest text-center">–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ:</div>
                <div id="summaryContent" class="space-y-1 text-sm text-slate-700 font-bold italic"></div>
            </div>
            
            <div class="flex gap-3">
                <button onclick="next(3)" class="w-1/3 bg-slate-100 py-5 rounded-2xl font-bold text-slate-400">‚Üê</button>
                <button onclick="saveRecord()" class="w-2/3 bg-emerald-500 text-white font-black py-5 rounded-2xl shadow-lg shadow-emerald-200">‚úì –ì–û–¢–û–í–û</button>
            </div>
        </div>
    </div>

    <div id="toast" class="toast"></div>

    <script>
        let reps = JSON.parse(localStorage.getItem('subpro_v61_data')) || [];
        let curLesson = 1;
        let curType = '100';

        // –†–µ–Ω–¥–µ—Ä —Å–µ—Ç–∫–∏ —É—Ä–æ–∫–æ–≤
        const lg = document.getElementById('lessonGrid');
        for(let i=1; i<=7; i++) {
            lg.innerHTML += `<div class="lesson-btn ${i==1?'active':''}" onclick="setLesson(${i}, this)">${i}</div>`;
        }

        function setLesson(num, el) {
            curLesson = num;
            document.querySelectorAll('.lesson-btn').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
        }

        function selectType(val) {
            curType = val;
            const b100 = document.getElementById('btn100');
            const b50 = document.getElementById('btn50');
            if(val === '100') {
                b100.className = "flex-1 py-4 rounded-xl font-black text-sm transition-all bg-white shadow-sm text-blue-600";
                b50.className = "flex-1 py-4 rounded-xl font-black text-sm transition-all text-slate-400";
            } else {
                b100.className = "flex-1 py-4 rounded-xl font-black text-sm transition-all text-slate-400";
                b50.className = "flex-1 py-4 rounded-xl font-black text-sm transition-all bg-white shadow-sm text-amber-500";
            }
            updateSummary();
        }

        function openWizard() {
            next(1);
            document.getElementById('wDate').valueAsDate = new Date();
            document.getElementById('wizard').classList.add('active');
            document.getElementById('overlay').classList.add('active');
            selectType('100'); // –°–±—Ä–æ—Å –Ω–∞ 100% –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        }

        function closeWizard() {
            document.getElementById('wizard').classList.remove('active');
            document.getElementById('overlay').classList.remove('active');
        }

        function next(step) {
            document.querySelectorAll('.step').forEach(s => s.classList.add('hidden'));
            document.getElementById('step' + step).classList.remove('hidden');
            if(step == 4) updateSummary();
        }

        function updateSummary() {
            const sum = document.getElementById('summaryContent');
            sum.innerHTML = `
                <div>‚Ä¢ ${document.getElementById('wDate').value} (${curLesson} —É—Ä–æ–∫)</div>
                <div>‚Ä¢ –ö–ª–∞—Å—Å: ${document.getElementById('wClass').value.toUpperCase()}</div>
                <div>‚Ä¢ –ü—Ä–µ–¥–º–µ—Ç: ${document.getElementById('wSubject').value}</div>
                <div>‚Ä¢ –ö—Ç–æ: ${document.getElementById('wBy').value}</div>
                <div>‚Ä¢ –í–º–µ—Å—Ç–æ: ${document.getElementById('wWho').value}</div>
                <div class="text-indigo-600 mt-2 text-center">–¢–∏–ø –æ–ø–ª–∞—Ç—ã: ${curType}%</div>
            `;
        }

        function saveRecord() {
            const data = {
                id: Date.now(),
                date: document.getElementById('wDate').value,
                lesson: curLesson,
                cls: document.getElementById('wClass').value.trim().toUpperCase(),
                subject: document.getElementById('wSubject').value.trim(),
                who: document.getElementById('wWho').value.trim(),
                by: document.getElementById('wBy').value.trim(),
                type: curType
            };

            if(!data.date || !data.cls || !data.by) return showToast('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ!');

            reps.push(data);
            localStorage.setItem('subpro_v61_data', JSON.stringify(reps));
            render();
            closeWizard();
            showToast('‚úì –ó–∞–ø–∏—Å—å –¥–æ–±–∞–≤–ª–µ–Ω–∞');
        }

        function render() {
            const container = document.getElementById('journal');
            const search = document.getElementById('search').value.toLowerCase();
            const filtered = reps.filter(r => 
                r.by.toLowerCase().includes(search) || r.subject.toLowerCase().includes(search) || r.cls.toLowerCase().includes(search)
            ).sort((a,b) => new Date(b.date) - new Date(a.date));

            container.innerHTML = filtered.map(r => `
                <div class="swipe-container shadow-sm border border-slate-100">
                    <div class="swipe-action" onclick="del(${r.id})">–£–î–ê–õ–ò–¢–¨ üóëÔ∏è</div>
                    <div class="swipe-item p-4 flex items-center gap-4" onclick="this.style.transform='translateX(0)'"
                         ontouchstart="ts(event)" ontouchmove="tm(event, this)" ontouchend="te(event, this)">
                        <div class="flex flex-col items-center bg-slate-50 min-w-[50px] py-1 rounded-2xl">
                            <span class="text-xl font-black leading-none">${new Date(r.date).getDate()}</span>
                            <span class="text-[9px] font-bold text-slate-400 uppercase tracking-tighter">${new Date(r.date).toLocaleDateString('ru-RU',{month:'short'}).replace('.','')}</span>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center gap-2 mb-0.5">
                                <span class="text-[9px] font-black bg-indigo-600 text-white px-1.5 rounded uppercase leading-tight">${r.cls}</span>
                                <span class="text-[10px] font-bold text-indigo-400 italic truncate">${r.subject}</span>
                            </div>
                            <div class="text-sm font-black text-slate-800 truncate">${r.by}</div>
                            <div class="text-[10px] text-slate-400 truncate tracking-tight">–∑–∞–º–µ–Ω—è–µ—Ç: ${r.who}</div>
                        </div>
                        <div class="text-right">
                            <div class="text-lg font-black ${r.type=='100'?'text-blue-600':'text-amber-500'} italic leading-none">${r.type}%</div>
                            <div class="text-[7px] font-black text-slate-300 uppercase">${r.type=='100'?'–û–ö–ù–û':'–£–†–û–ö'}</div>
                        </div>
                    </div>
                </div>
            `).join('') || '<div class="py-20 text-center text-white/40 font-bold uppercase italic tracking-widest text-xs">–ñ—É—Ä–Ω–∞–ª –ø—É—Å—Ç</div>';
            
            updateStats();
        }

        // Swipe Logic
        let sX = 0;
        const ts = e => { sX = e.touches[0].clientX; document.querySelectorAll('.swipe-item').forEach(el => {if(el !== e.currentTarget) el.style.transform = 'translateX(0)'}); };
        const tm = (e, el) => {
            let mX = e.touches[0].clientX - sX;
            if (mX < 0 && mX > -120) el.style.transform = `translateX(${mX}px)`;
        };
        const te = (e, el) => {
            let fX = parseInt(el.style.transform.replace(/[^-0-9]/g,'')) || 0;
            el.style.transform = fX < -60 ? 'translateX(-80px)' : 'translateX(0)';
        };

        function del(id) {
            if(confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å?')) {
                reps = reps.filter(r => r.id !== id);
                localStorage.setItem('subpro_v61_data', JSON.stringify(reps));
                render();
            }
        }

        function showToast(m) {
            const t = document.getElementById('toast'); t.textContent = m;
            t.classList.add('show'); setTimeout(() => t.classList.remove('show'), 2000);
        }

        function updateStats() {
            document.getElementById('statTotal').textContent = reps.length;
            document.getElementById('stat100').textContent = reps.filter(r => r.type == '100').length;
            document.getElementById('stat50').textContent = reps.filter(r => r.type == '50').length;
            document.getElementById('statMonth').textContent = reps.filter(r => new Date(r.date).getMonth() == new Date().getMonth()).length;
        }

        function exportJSON() {
            const b = new Blob([JSON.stringify(reps)], {type:'application/json'});
            const a = document.createElement('a'); a.href = URL.createObjectURL(b);
            a.download = `zavuch_pro_v61.json`; a.click();
        }

        render();
    </script>
</body>
</html>
